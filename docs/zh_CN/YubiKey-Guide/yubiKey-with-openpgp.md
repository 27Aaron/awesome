# YubiKey 与 OpenPGP 结合使用

## 在 Yubikey 外部生成

::: tip
密钥有 4 种类型：S、C、E 和 A。S 用于签名，C 用于认证，E 用于加密，A 用于身份验证。

注意：电子邮件地址必须设置为与您的 GitHub 帐户相同的电子邮件地址。否则，您无法使用 GPG 签署提交。
:::

### 生成主密钥
- 1、将 Yubikey 插入电脑的 USB 口。
- 2、输入 GPG 命令 `gpg --expert --full-gen-key`。
- 3、选择 `(8) RSA（自定义用途）`。
- 4、输入 S，取消签名（Sign）。
- 5、输入 E，取消加密（Encrypt）。
- 6、输入 Q，选择(Q) 已完成。
- 7、密钥长度为 4096 位。
- 8、有效期输入 0 ，0 = 密钥永不过期。
- 9、输入姓名和邮箱。
- 10、输入 o ，确定（O）。

### 添加签名密钥
- 1、键入 `addkey` 添加密钥。
- 2、输入 E，取消加密（Encrypt）。
- 3、输入 Q，(Q) 已完成。
- 4、密钥长度为 4096 位。
- 5、输入 `1y` ，创建1年的签名密钥。
- 6、输入 `y` 确认创建。

### 添加加密密钥
- 1、键入 `addkey` 添加密钥。
- 2、输入 S，取消签名（Sign）。
- 3、输入 Q，(Q) 已完成。
- 4、密钥长度为 4096 位。
- 5、输入 `1y` ，创建1年的加密密钥。
- 6、输入 `y` 确认创建。

### 添加认证密钥
- 1、键入 `addkey` 添加密钥。
- 2、输入 S，取消签名（Sign）。
- 3、输入 E，取消加密（Encrypt）。
- 4、输入 A，添加身份验证（Authenticate）。
- 5、输入 Q，(Q) 已完成。
- 6、密钥长度为 4096 位。
- 7、输入 `1y` ，创建1年的认证密钥。
- 8、输入 `y` 确认创建。

## 将密钥导入 YubiKey
- 1、输入 GPG 命令：gpg --edit-key 1234ABC（其中 1234ABC 是您的密钥的密钥 ID，可以通过 `gpg -K` 查询）。
- 2、输入命令：keytocard 。
- 3、提示您是否确实要移动主密钥时，请输入 y（是）。
- 4、当提示存储密钥的位置时，选择 1。这会将签名子密钥移动到 YubiKey 的 PGP 签名槽。
- 5、输入命令：key 1 。
- 6、输入命令：keytocard 。
- 7、当提示存储密钥的位置时，选择 2。这会将加密子密钥移动到 YubiKey。
- 8、输入命令：key 1 。
- 9、输入命令：key 2 。
- 10、输入命令：keytocard 。
- 11、当提示存储密钥的位置时，选择 3。这会将身份验证子密钥移至 YubiKey。
- 12、输入命令：quit 。
- 13、当提示保存更改时，输入 n（否）。否则，GPG 将从硬盘中删除您的密钥，并且您将无法将其复制到另一个 YubiKey 将其保留为备份。

## 直接在 YubiKey 上生成 PGP 密钥
::: warning
在 YubiKey 上生成 PGP 可确保恶意软件永远无法窃取您的 PGP 私钥，但这意味着该密钥无法备份，因此如果您的 YubiKey 丢失或损坏，PGP 密钥将无法恢复。 
:::
- 1、输入命令：gpg --card-edit 。
- 2、在gpg/card>提示符下，输入命令：admin
- 3、如果要使用大于 2048 位的密钥，请运行：key-attr 。
- 4、输入命令： generate 。
- 5、出现提示时，指定是否要对加密密钥进行卡外备份。 
  - 注意：这是私钥的填充备份，而不是完整备份，并且不能用于恢复到新的 YubiKey。
- 6、指定密钥的有效期限（以天、周、月或年为单位指定数字）。
- 7、输入姓名和电子邮箱。
- 8、输入默认管理员 PIN 码。
- 9、输入密码，因为如果没有密码，密钥将不允许您通过。如果不输入密码，生成将会失败。

## 测试
```bash
echo test | gpg --encrypt --recipient <your login email> | gpg --decrypt

```